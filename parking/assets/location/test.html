<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Current location Tracking Successfully</title>
	<style type="text/css">html, body {
		    height: 100%;
		    margin: 0;
		    padding: 0;
		}
		#map {
		    height: 100%;
		}
	</style>
</head>
<body style="height: 600px;width:1170px;margin: 50px auto 0">
	<button onclick="current_location_see()">CURRENT LOCATION</button> 

	<input type="text" id="form_loc" value="Dhaka">
	<input type="text" id="to_loc" value="Chittagong">
	<select id="mode">
		<option value="DRIVING">DRIVING</option>
		<option value="WALKING">WALKING</option>
	</select>
	<button onclick="between_search()">Direction</button>

	<br><br>

	<div id="map"></div>

	<br><br>
	<p>Total Distance: <span id="total"></span></p>
	<p id="right-panel"></p>

	<script src="http://code.jquery.com/jquery.js"></script>
	<!-- new API -->
    <script>

    	function between_search(){
    		var from=jQuery('#form_loc').val();
            var to=jQuery('#to_loc').val();
            var mode=jQuery('#mode').val();
            //alert(from+to+mode);

              var map3 = new google.maps.Map(document.getElementById('map'), {
	            zoom: 4,
	            center: {lat: 21.405983, lng: 91.989899}  // Chittagong., 
	          });
              var directionsService = new google.maps.DirectionsService;
	          var directionsDisplay = new google.maps.DirectionsRenderer({
	            draggable: true,
	            map: map3,
	            panel: document.getElementById('right-panel')
	          });

	          directionsDisplay.addListener('directions_changed', function() {
	            computeTotalDistance(directionsDisplay.getDirections());
	          });

	          displayRoute(from, to, directionsService, directionsDisplay,mode);

             google.maps.event.trigger(map3,'resize');


    	}


    	function displayRoute(origin, destination, service, display,mode) {
        service.route({
          origin: origin,
          destination: destination,
          waypoints: [/*{location: 'Adelaide, SA'}, {location: 'Broken Hill, NSW'}*/],
          travelMode: google.maps.TravelMode[mode],
          avoidTolls: true
        }, function(response, status) {
          if (status === google.maps.DirectionsStatus.OK) {
            display.setDirections(response);
          } else {
            alert('Could not display directions due to: ' + status);
          }
        });
      }



      function computeTotalDistance(result) {
        var total = 0;
        var myroute = result.routes[0];
        for (var i = 0; i < myroute.legs.length; i++) {
          total += myroute.legs[i].distance.value;
        }
        total = total / 1000;
        document.getElementById('total').innerHTML = total + ' km';
      }











      function initMap() {

        var sohel = new google.maps.Map(document.getElementById('map'), {
		    center: {lat: 17.0575486, lng: -11.2739606},
		    zoom: 3

		});

		/*var infoWindow = new google.maps.InfoWindow({
			map: sohel
		});

		// Try HTML5 geolocation.
		if (navigator.geolocation) {
		    navigator.geolocation.getCurrentPosition(function(position) {
		        var pos = {
		            lat: position.coords.latitude,
		            lng: position.coords.longitude
		        };

		        infoWindow.setPosition(pos);
		        infoWindow.setContent('Location found.');
		        sohel.setCenter(pos);
		        sohel.setZoom(16);
		    }, function() {
		        handleLocationError(true, infoWindow, sohel.getCenter());
		    });
		} else {
		    // Browser doesn't support Geolocation
		    handleLocationError(false, infoWindow, sohel.getCenter());
		}

		function handleLocationError(browserHasGeolocation, infoWindow, pos) {
		    infoWindow.setPosition(pos);
		    infoWindow.setContent(browserHasGeolocation ?
            'Error: The Geolocation service failed.' :
            'Error: Your browser doesn\'t support geolocation.');
		}
		*/

    }


    function current_location_see(){
    	var sohel = new google.maps.Map(document.getElementById('map'), {
		    center: {lat: 17.0575486, lng: -11.2739606},
		    zoom: 3

		});


    	var infoWindow = new google.maps.InfoWindow({
			map: sohel
		});




		// Try HTML5 geolocation.
		if (navigator.geolocation) {
		    navigator.geolocation.getCurrentPosition(function(position) {
		        var pos = {
		            lat: position.coords.latitude,
		            lng: position.coords.longitude
		        };

		        infoWindow.setPosition(pos);
		        infoWindow.setContent('Location found.');
		        sohel.setCenter(pos);
		        sohel.setZoom(16);
		    }, function() {
		        handleLocationError(true, infoWindow, sohel.getCenter());
		    });
		} else {
		    // Browser doesn't support Geolocation
		    handleLocationError(false, infoWindow, sohel.getCenter());
		}

		function handleLocationError(browserHasGeolocation, infoWindow, pos) {
		    infoWindow.setPosition(pos);
		    infoWindow.setContent(browserHasGeolocation ?
            'Error: The Geolocation service failed.' :
            'Error: Your browser doesn\'t support geolocation.');
		}
    }




    </script>



    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCKf3D0CKv98W_EGTk5QfKANDh0CZuAlNc&callback=initMap"></script>
    <!-- new api end -->

</body>
</html>